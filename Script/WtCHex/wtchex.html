<!DOCTYPE html>
<html>
<style>
    html, body {
      width:  100%;
      height: 100%;
      margin: 0px;
    }
</style>
<body>












<canvas id="hexmap" width="600" height="400"  onclick="clickCoord()">
Your browser does not support the HTML5 canvas tag.</canvas>


<section style="display: flex;">
    <form style="padding: 10px; margin: 10px;  background: rgba(0,0,0,0.1);">
        <h2>Rectangular Coords</h2>
        X: <input type="number"  id="Xcoord" onChange="rectToHex()" value="0.5" step=0.1  min="-1.2" max="1.2"style="width: 5em;"/>
        Y: <input type="number"  id="Ycoord" onChange="rectToHex()" value="0.5" step=0.1  min="-1" max="1"style="width: 5em;"/>
    </form>
    <form style="padding: 10px; margin: 10px;  background: rgba(0,0,0,0.1);">
        <h2> Hexline Offset Coords</h2>
        A: <input type="number"  id="Acoord" onChange="hexToRectA()" value="0.1" step=0.1  min="-1" max="1" style="width: 5em;"/>
        B: <input type="number"  id="Bcoord" onChange="hexToRectB()" value="0.1" step=0.1  min="-1" max="1"style="width: 5em;"/>
        C: <input type="number"  id="Ccoord" onChange="hexToRectC()" value="0.1" step=0.1  min="-1" max="1" readonly disabled style="width: 5em;"/>
    </form>
    
</section>



<script>

//witness the power of my jank!

function rectToHex(){
    var X = document.getElementById("Xcoord").value;
    var Y = document.getElementById("Ycoord").value;
    X = Number(X);
    Y = Number(Y);
    //Update A  B and C accordingly.
    A = (Math.sqrt(3)*X - Y)/2;
    B = Y;
    C = 0 - A - B;
    //Change the input boxes
    document.getElementById("Acoord").value = Math.round(10000*A)/10000;
    document.getElementById("Bcoord").value = Math.round(10000*B)/10000;
    document.getElementById("Ccoord").value = Math.round(10000*C)/10000;
    //Check for overbounds
    //TODO
    //update the spot on the map
    hexCoord(X,-Y);
}

function hexToRect(){
    var A = document.getElementById("Acoord").value;
    var B = document.getElementById("Bcoord").value; 
    A = Number(A);
    B = Number(B);
    //Update X and Y  and C accordingly.
    Y = B;
    X = (2*A+Y)/(Math.sqrt(3));
    C = 0 - A - B;
    //Change the input boxes
    document.getElementById("Xcoord").value = Math.round(10000*X)/10000;
    document.getElementById("Ycoord").value = Math.round(10000*Y)/10000;
    document.getElementById("Ccoord").value = Math.round(10000*C)/10000;
    //update the spot on the map
    hexCoord(X,-Y);
}

//Specific update fucntions which balance movement along each of the other two

function hexToRectB(){
    var A = document.getElementById("Acoord").value;
    var B = document.getElementById("Bcoord").value; 
    var C = document.getElementById("Ccoord").value; 
    A = Number(A);
    B = Number(B);
    C = Number(C);
    //Figure out how much we need to wiggle each of the other ones.
    altitude = A+B+C;
    A = A -altitude/2;
    C = C - altitude/2;
    //Update X and Y  and C accordingly.
    Y = B;
    X = (2*A+Y)/(Math.sqrt(3));
    //Change the input boxes
    document.getElementById("Xcoord").value = Math.round(10000*X)/10000;
    document.getElementById("Ycoord").value = Math.round(10000*Y)/10000;
    document.getElementById("Acoord").value = Math.round(10000*A)/10000;
    document.getElementById("Ccoord").value = Math.round(10000*C)/10000;
    //update the spot on the map
    hexCoord(X,-Y);
}

function hexToRectA(){
    var A = document.getElementById("Acoord").value;
    var B = document.getElementById("Bcoord").value; 
    var C = document.getElementById("Ccoord").value; 
    A = Number(A);
    B = Number(B);
    C = Number(C);
    //Figure out how much we need to wiggle each of the other ones.
    altitude = A+B+C;
    B = B -altitude/2;
    C = C - altitude/2;
    //Update X and Y  and C accordingly.
    Y = B;
    X = (2*A+Y)/(Math.sqrt(3));
    //Change the input boxes
    document.getElementById("Xcoord").value = Math.round(10000*X)/10000;
    document.getElementById("Ycoord").value = Math.round(10000*Y)/10000;
    document.getElementById("Bcoord").value = Math.round(10000*B)/10000;
    document.getElementById("Ccoord").value = Math.round(10000*C)/10000;
    //update the spot on the map
    hexCoord(X,-Y);
}

function hexToRectC(){
    var A = document.getElementById("Acoord").value;
    var B = document.getElementById("Bcoord").value; 
    var C = document.getElementById("Ccoord").value; 
    A = Number(A);
    B = Number(B);
    C = Number(C);
    //Figure out how much we need to wiggle each of the other ones.
    altitude = A+B+C;
    A = A -altitude/2;
    B = B - altitude/2;
    //Update X and Y  and C accordingly.
    Y = B;
    X = (2*A+Y)/(Math.sqrt(3));
    //Change the input boxes
    document.getElementById("Xcoord").value = Math.round(10000*X)/10000;
    document.getElementById("Ycoord").value = Math.round(10000*Y)/10000;
    document.getElementById("Acoord").value = Math.round(10000*A)/10000;
    document.getElementById("Bcoord").value = Math.round(10000*B)/10000;
    //update the spot on the map
    hexCoord(X,-Y);
}



function clickCoord(){
    const rect = canvas.getBoundingClientRect();
    const canvasx = event.clientX - rect.left;
    const canvasy = event.clientY - rect.top;

    r = (canvas.height/2)*(Math.sqrt(3)/2);
    var x = canvasx - canvas.width/2;
    var y = canvasy - canvas.height/2;
    y = -y;

    x = Math.round(10000*x/r)/10000;
    y = Math.round(10000*y/r)/10000;

    
    document.getElementById("Xcoord").value = x;
    document.getElementById("Ycoord").value = y;
    rectToHex();
    
}
     






var canvas = document.getElementById("hexmap");
var ctx = canvas.getContext("2d");

function randomInt(max) {return Math.floor(Math.random() * max);}

function drawLine(x1,y1,x2,y2,context) {
  context.moveTo(x1,y1);
  context.lineTo(x2,y2);  
  context.strokeStyle = '#000';
  context.stroke(); 
}

//take in array of coords. fill polygon
function drawPoly(vertices,fillColor,lineColor){
  ctx.fillStyle = fillColor;
  ctx.beginPath();
  for (var i = 0; i < vertices.length; i++) {
    ctx.lineTo(vertices[i][0],vertices[i][1]);
  }
  ctx.closePath();
  ctx.fill();
  ctx.strokeStyle = lineColor;
  ctx.stroke(); 
}


function translatePoint(x,y,theta,r) {
  newy = y+r*Math.sin(theta);
  newx = x+r*Math.cos(theta);
  return [newx,newy];
}

//draw hex with point sideways and side upwards
function drawHex2(x, y, r, color, border, text, context) {
  //base angle and incremental angle
  ba = 0;
  ia = Math.PI/3;
  //find vertices
  var vertices = [];
  for (var i = 0; i < 6; i++) { 
    vertices[i] = translatePoint(x,y,ba+i*ia,r);
  }
  vertices[6]=vertices[0];
  //draw the shape background
  drawPoly(vertices,color,border);
  //add text. first stroke and then fill the inside
  ctx.font = r.toString()+"px Impact";
  ctx.textAlign = "center";
  ctx.textBaseline = 'middle'; 
  ctx.strokeStyle = '#000';
  ctx.lineWidth = 2;
  ctx.strokeText(text, x, y);
  ctx.fillStyle = '#fff';
  ctx.fillText(text,x,y);
}


function drawDot(x,y,r,fillColor,lineColor){
    ctx.beginPath();
    ctx.arc(x, y, r, 0, 2 * Math.PI, true);
    ctx.fillStyle = fillColor;
    ctx.fill();
    ctx.strokeStyle = lineColor;
    ctx.stroke(); 
}


function hexCoord(x,y){
    //refresh canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    //ctx.canvas.width  = window.innerWidth;
    //ctx.canvas.height = window.innerHeight;
    r = (canvas.height/2)*(Math.sqrt(3)/2);
    //drawRectangle(0, 0, canvas.width, canvas.height,'#00f3','#0000');
    drawHex2(canvas.width/2,canvas.height/2,canvas.height/2,'#aaf','#33f', '',ctx);
    drawDot(canvas.width/2,canvas.height/2,3,'#33f','#0000', '',ctx);
    //coords are given in terms of radius of hex. Conver to pixels
    x = canvas.width/2 + r*x;
    y = canvas.height/2 + r*y
    drawDot(x,y,3,'#faa','#f00', '',ctx);

}


rectToHex();



</script>

</body>
</html>
